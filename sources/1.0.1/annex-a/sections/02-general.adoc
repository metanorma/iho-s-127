

== General

=== Introduction

This S-127 Data Classification and Encoding Guide (DCEG) contains
rules and guidance for converting data describing the real world into
data products that conform to the S-127 specification.

The S-127 specification contains an application schema (UML model)
describing the conceptual domain model in terms of classes and relationships,
and a Feature Catalogue (see S-127 Annex C) that specifies the data
model, i.e., specifies the data model types and associations corresponding
to the various classes and relationships in the application schema.

To simplify the DCEG text, the various data model types will be provided
without the suffixes "class", "type" or "instance"; e.g. the term
"feature" should be understood as "feature class" or "feature type"
or "feature instance" as best fits the immediate context in which
it is used (and where there might be confusion, it is written out
in full as feature class/type/instance).

The model defines real world entities as a combination of descriptive
and spatial characteristics (S-127 Product Specification clause 6).

This clause of the DCEG contains general information needed to understand
the encoding rules and describes fundamental common rules and constraints.
It also describes datasets and metadata. The data model object types
used within S-127 and their encoding rules and guidelines are defined
in detail in subsequent clauses of this document.

Within this document the features, information types, associations,
and attributes appear in *bold text*.

=== Descriptive characteristics

==== Feature

A feature contains descriptive attributes that characterize real world
entities.

The word 'feature' as used in the ISO 191xx series and in S-100 based
product specifications has two distinct but related senses -- 'feature
type' and 'feature instance'. A feature instance is a single occurrence
of the feature and is represented as an object in a dataset.

The location of a feature instance on the Earth's surface is indicated
by a relationship to one or more spatial primitive instances. A feature
instance may exist without referencing a spatial primitive instance.

===== Geographic feature class

*Geographic (Geo) feature types* carry the descriptive characteristics
of a real world entity which is provided by a spatial primitive instance.

===== Meta feature class

*Meta feature type* contains information about other features.

===== Charted background feature

The data product would mostly be visualized as an overlay of an ENC
or other GIS applications. Consequently, all necessary descriptive
and spatial characteristics to provide a charted background should
be provided by the underlying application.

==== Information type

An information type has no geometry and therefore is not associated
to any spatial primitives to indicate its location.

An information type may have attributes and can be associated with
features or other information types in order to carry information
particular to these associated features or information types.

=== Spatial characteristics

==== Spatial primitives

The allowable spatial primitive for each feature is defined in the
Feature Catalogue. Allowable spatial primitives are point, curve,
and surface.

Within this document, allowable spatial primitives are included in
the description of each feature. For easy reference,

<<table_2-1>> below summarises the allowable spatial primitives for
each feature. In the table, abbreviations are as follows: point (P),
curve (C), surface (S), and none (N).

[[table_2-1]]
.Features permitted and their spatial primitives
[cols="325,33,33,33,32"]
|===
h| Feature h| P h| C h| S h| N

| Radio Calling in Point                | X | X |   |
| Caution Area                          | X |   | X |
| Signal Station Warning                | X |   |   |
| Signal Station Traffic                | X |   |   |
| Radar Range                           |   |   | X |
| Concentration of Shipping Hazard Area |   |   | X |
| Pilot District                        |   |   | X |
| Pilot Service                         |   |   | X |
| Underkeel Clearance Allowance Area    |   |   | X |
| Underkeel Clearance Management Area   |   |   | X |
| Routeing Measure                      |   | X | X |
| ISPS Code Security Level              |   | X | X |
| Waterway Area                         |   |   | X |
| Pilot Boarding Place                  | X |   | X |
| Military Practice Area                |   |   | X |
| Restricted Area, Regulatory           |   |   | X |
| Restricted Area, Navigational         |   |   | X |
| Vessel Traffic Service Area           |   |   | X |
| Place of Refuge                       |   |   | X |
| Piracy Risk Area                      |   |   | X |
| Local Port Service Area               |   |   | X |
| Ship Reporting Service Area           |   |   | X |
|===

==== Capture density guideline

The capture density will follow the recommendation of the S-101 (ENC)
DCEG, which states curves and surface boundaries should not be encoded
at a point density greater than 0.3 mm at permitted display scale.

A curve consists of one or more curve segments. Each curve segment
is defined as a loxodromic line on WGS84, or as an arc or circle.
Long lines may need to have additional coordinates inserted to cater
for the effects of projection change.

The presentation of line styles may be affected by curve length. Therefore,
the encoder must be aware that splitting a curve into numerous small
curves may result in poor symbolization.

=== Attributes

Attributes may be simple type or complex type. Complex ++(C)++ attributes
are aggregates of other attributes that can be simple type or complex
type attributes. Simple (S) attributes are assigned to one of the
types collected at see <<sec_2.4.1>>.

The binding of attributes to a feature, the binding of attributes
to attributes to construct complex attributes, and attribute multiplicity
are all defined in the Feature Catalogue.

Within this document, the allowable attributes are included in the
description of each feature, as well as the allowable values for enumeration
type attributes.

[[sec_2.4.1]]
==== Simple attribute types

Each simple attribute (S) is assigned to one of attribute types in
<<table_2-2>> (in alphabetic order):

[[table_2-2]]
.Simple attribute types
[cols="a,a,a"]
|===
h| Abbreviation h| Attribute type h| Description

| BO | Boolean | A value representing binary logic. The value can
be either True or False. The default state for Boolean type attributes
(i.e. where the attribute is not populated for the feature) is False.
| CL | Code List | A type of flexible enumeration (see "EN" below).
A code list type is a list of literals which may be extended only
in conformance with specified rules. Attributes of a code list type
may take values from the list or other values which are defined according
to the rules. The rules should be part of the specification of the
individual codelist type. A code list could either be closed (fixed)
or open (extensible).

A code list type has the following properties: 1. A description of
the code list type, 2. The URI where the list could be found, and
3. An encoding instruction.
| DA | Date | A date provides values for year, month and day according
to the Gregorian Calendar.

[example]
19980918 (YYYYMMDD)
| DT | Date and Time | A DateTime is a combination of a date and a
time type.

[example]
19850412T101530 (YYYYMMDDThhmmss)
| EN | Enumer-ation | A fixed list of valid identifiers of named literal
values. Attributes of an enumerated type may only take values from
this list.
| IN | Integer | A signed integer number. The representation of an
integer is encapsulation and usage dependent.

Integer attribute values must not be padded by non-significant zeroes.
For example, for a number of 19, the value populated for the attribute
must be 19 and not 019.

[example]
29, -65547
| RE | Real | A signed real (floating point) number consisting of
a mantissa and an exponent. The representation of a real is encapsulation
and usage dependent.

Real attribute values must not be padded by non-significant zeroes.
For example, for a signal period of 2.5 seconds, the value populated
for the attribute signal period must be 2.5 and not 02.50.
4
[example]
23.501, -0.0001234, -23.0, 3.141296
| TD | Truncated Date | One or more significant components of the
modelling date are omitted.

[example]
pass-format:metanorma[----02--] (Year and date not encoded)

The exact format depends on the encoding.

A GML dataset would use a GML built-in type
and encode it as

<gMonth>pass-format:metanorma[--02]<gMonth>.

An 8211 data format based dataset would truncated encode the date
as pass-format:metanorma[----02--].
| TE | Free text | A CharacterString is an arbitrary-length sequence
of characters including accents and special characters from a repertoire
of one of the adopted character sets.
| TI | Time | A time is given by an hour, minute, and second. Time
zone according to UTC is optional. Character encoding of a time is
a string that follows the local time.

[example]
183059 or 183059+0100 or 183059Z
|

| URL
| A uniform resource locator (URL) is a URI that provides a means
of locating the resource by describing its primary access mechanism
(RFC 3986).

[example]
http://registry.iho.int

|

| URN
| A persistent, location-independent, resource identifier that follows
the syntax and semantics for URNs specified in RFC 2141.

[example]
urn:mrn:iho:s127:1:0:0:RouteingMeasure

|===

==== Mandatory attributes

Some attributes are mandatory and must be populated for a given feature.
There are some reasons why attribute values may be considered mandatory:

* They are fundamental to the definition of a feature;
* They are required to support the correct portrayal of a feature
instance;
* Certain features make no logical sense without specific attributes;
* Some attributes are required for safety of navigation.

Within this document, mandatory attributes are those with a multiplicity
of 1,1 or 1,n (n>1) or 1,*. The attribute multiplicity is identified
in the description of each feature class.

For easy reference, <<table_2-3>> summarises the mandatory attributes
for each feature.

[[table_2-3]]
.Mandatory attributes for feature classes
[cols="211,360"]
|===
h| Feature h| Mandatory Attributes

| Radio Calling in Point              | trafficFlow
| Restricted Area Navigational        | restriction
| Signal Station Warning              | categoryOfSignalStationWarning
| Signal Station Traffic              | categoryOfSignalStationTraffic
| Pilot Service                       | remotePilot
| Underkeel Clearance Management Area | dynamicResource
| Routeing Measure                    | categoryOfRouteingMeasure
| ISPS Code Security Level            | ispsLevel
| Waterway Area                       | dynamicResource
| Local Port Service Area             | requirementsForMaintenanceOfListeningWatch
| Ship Reporting Service Area         | requirementsForMaintenanceOfListeningWatch
| Vessel Traffic Service Area         | requirementsForMaintenanceOfListeningWatch
| Text Placement                      | textJustificationexactly one of: textType, text

|===

==== Conditional attributes

The feature classes or information types do not contain conditional
attributes.

Complex attributes which are assigned to feature classes or information
types have at least one sub-attribute which is mandatory (or conditionally
mandatory). Mandatory sub-attributes of complex attributes have not
been included in <<table_2-3>>. Where the sub-attribute of a complex
attribute is conditional, this is indicated in the Remarks sub-clause
for the relevant feature class entries in Clause 5.

[[sec_2.4.4]]
==== Missing attribute values

Where a value of a mandatory attribute is not known, the attribute
must be populated with an empty (null) value.

Where the value of a non-mandatory attribute is not known, the attribute
must not be included in the dataset.

==== Multiplicity

In order to control the number of allowed attribute values or sub-attribute
instances within a complex attribute, S-100 uses the concept of multiplicity.
This defines lower and upper limits for the number of values, whether
the order of the instances is significant, and if an attribute is
mandatory. Common examples are shown in <<table_2-4>>:

Format: MinOccurs, MaxOccurs (a ++*++ indicates that infinite instances
are possible, the term (ordered) indicates that the order of the provided
instances is significant)

[[table_2-4]]
.Multiplicity of attributes
[cols="27,88"]
|===
h| Multiplicity h| Explanation

| 0,1 | An instance is not required; if provided there must only be one instance.
| 1,1 | An instance is required and there must only be one instance.
| 0,* | An instance is not required and there can be an infinite number of instances.
| 1,* | An instance is required and there can be an infinite number of instances.
| 1,* (ordered)
| An instance is required and there can be an infinite number of instances,
the order of which is significant.
| 2,2 | Two instances are required and there must be no more than two.

|===

==== Spatial attribute types

Spatial attribute types must contain a referenced geometry and may
be associated with spatial quality attributes. Each spatial attribute
instance must be referenced by a feature instance or another spatial
attribute instance.

===== Quality of spatial attributes

The quality of spatial attributes in S-127 is described in a
*Quality of Non-Bathymetric Data* meta-feature. This meta-feature
defines areas within which uniform assessment exists for the quality.
It is described in detail later in this document.

If the spatial quality attributes for an individual instance of a
spatial primitive differ from the quality indicated in the overlying
*Quality of Non-Bathymetric Data* meta-feature, the quality attributes
for that instance are carried in an information class called
*spatial quality*. Only points and curves can be associated with
*spatial quality*. S-127 does not use multi-points. Currently, no
use case for associating surfaces with spatial quality attributes
is known, therefore this is prohibited. Vertical uncertainty is prohibited
for curves as this dimension is not supported by curves.

NOTE: S-127 does not make use of the S-101
*Quality of Bathymetric Data* meta-feature since depth range uncertainties
are not needed. The *Quality of Non-Bathymetric Data* meta-feature
has all the quality attributes needed by S-127.

[[fig_1]]
.Spatial quality information
image::figure-1.png[]

==== Portrayal feature attributes

Marine Traffic Management data products will be used within ECDIS
where ENC data is displayed based on the rules defined within the
S-101 Portrayal Catalogue. While most ECDIS portrayal is based on
attributes describing the instance of a particular feature in the
real world, certain feature attributes are used in portrayal rules
to provide additional functionality in the ECDIS. <<table_2-5>> provides
a list of attributes which have been adopted from the S-101 (ENC)
product specification and which have specific influence on portrayal.

[[table_2-5]]
.Attributes which have effects on portrayal
[cols="214,363"]
|===
h| Attribute h| Effects on portrayal
| *displayName*
| This Boolean attribute determines if the text for a name should
be displayed. If not populated the default rules provided in the portrayal
catalogue will be used.
| *information*
| Population of this complex attribute will result in the display
of the magenta information symbol to highlight additional information
to the user.
| *pictorialRepresentation*
| The population of this Text attribute will result in the display
of the magenta information symbol to highlight additional information
to the user.
| *textContent*
| The population of this complex attribute will result in the display
of the magenta information symbol to highlight additional information
to the user.

|===

[NOTE,keep-separate=true]
====
Since S-127 data is scale-independent, the S-101 attribute scaleMinimum
is superfluous and not used in S-127 datasets except for the cartographic
feature TextPlacement.
====

==== Textual information

Textual information may provide additional information essential to
understand the presence of the Marine Traffic Management and other
features of an S-127 product. This information may also provide legal
information pertaining to the S-127 product features.

===== Specialized information types for common kinds of textual information

The information types *Restrictions, Recommendation, Regulations*,
or *NauticalInformation* must be used to encode text information when
the DCEG allows them to be associated to the feature or information
type and the information is of the appropriate kind
(a restriction, regulation, etc.).

In exceptional circumstances and only if the use of the information
types *Restrictions, Recommendation,* or *Regulations* is not sufficient,
*NauticalInformation* can be used to encode additional textual information
associated to a feature or a group of features.

In some cases, there may be a specialized attribute that is specifically
intended for the data in question. If an appropriate specialized attribute
is available, it must be used in preference to *information* or *textContent*.
For example, feature names will generally be encoded in the *name*
sub-attribute of complex attribute *featureName*, instead of *information*++->++*text*.

===== Textual information attributes

Textual information which is not appropriate for any of the Text-type
attribute (or sub-attribute) allowed for the feature/information type
should be encoded using either *information* or *textContent* complex
attributes. Generally, either *information* or *textContent* is allowed,
but not both.

===== Languages

Both *information* and *textContent* define a *language* sub-attribute
for specifying the language in which the text is encoded.

The exchange language for textual information should be English; therefore
it is not required to populate the sub-attribute *language* for an
English version of textual information.

Languages other than English may be used as a supplementary option,
for which *language* must be populated with an appropriate value to
indicate the language.

When a national language is used in the textual attributes, the English
translation must also exist.

===== Minimal use of generalized text attributes

The complex attributes *information* and *textContent* must not be
used when it is possible to encode the information by means of any
other attribute. The population of these attributes provides symbols
on an ECDIS screen. Therefore producers should carefully consider
use of these attributes as the symbol may contribute significantly
to ECDIS screen clutter and text attributes should be populated only
when the content conveys useful information.

===== Short textual information

The *text* sub-attribute of complex attribute *information* should
generally be used for short notes or to transfer information which
cannot be encoded by other attributes, or to give brief information
about a feature. The use of the complex attribute *information* as
a stand-alone complex attribute is intentionally limited to the information
types *ContactDetails, Applicability, NonStandardWorkingDay,* and
*ServiceHours,* which do not need the additional attributes defined
in *textContent*. The reason for the limited use of *information*
as a stand-alone complex attribute is to provide a structured and
harmonised approach to textual information within the S-127 product
data sets.

The text populated in *text* must not exceed 300 characters. Character
strings contained in *text* sub-attribute must be UTF-8 character
encoding.

If the *text* sub-attribute of *information* is populated, the *headline*,
*fileReference*, and *fileLocator* sub-attributes must not be populated.

===== Complex or lengthy textual information

More complex encodings of text may use either *information* or *textContent*.
The feature catalogue and the feature/information type definitions
in this DCEG indicate whether *information* or *textContent* is allowed.

The complex attribute *textContent* also has *information* as a complex
sub-attribute. If a short note must be encoded in a feature or information
type which has only *textContent* as an attribute, it should be encoded
as *textContent*++->++*information*++->++*text*.

Complex text information, such as text longer than 300 characters,
formatted text, or HTML extracts from shipping regulations, must be
encoded in a file named in either *information*++->++*fileReference*
or *textContent*++->++*information*++->++*fileReference*. The construction
*textContent*++->++*information*++->++*fileReference* should be used
if the feature/information type provides *textContent* as complex
attribute.

The complex attribute *information* defines an optional sub-attribute
*headline* which may be used for a short title not exceeding 60 characters.
The content should be short but informative -- if the textual information
is divided into sections, the most relevant section header from the
referenced content may be a good choice for *headline*.

The complex attribute *textContent* defines an optional sub-attribute
*categoryOfText* for indicating whether the text is the full text
from the source, an extract from the source, or a summary prepared
by the encoder. Populating *categoryOfText* is recommended whenever
the textual information is taken or summarized from a law or regulation.

If it is considered necessary to include a description of the source
of the textual information, the sub-attribute *sourceIndication* of
*textContent* must be used. Encoding a description of the source is
strongly recommended for textual information whose source is considered
as information the end-user must have, e.g., because the date of issue
must be conveyed or because it cites official regulations which are
frequently updated.

COMMENT: Some government documents are frequently updated, e.g., the
U.S. Electronic Code of Federal Regulations, which is currently updated
every working day even though a particular section may be stable for
years.

==== Attributes referencing external files

===== Predefined derived types

<<table_2-6>> presents the following predefined derived types which
are described in S-100 (§ 1-4.6 in Edition 4.0.0):

[[table_2-6]]
.Predefined derived types
[cols="45,412,105"]
|===
h| Name h| Description h| Derived from

| URI
a| A uniform resource identifier which character encoding shall follow
the syntax rules as defined in RFC 3986.

[example]
http://registry.iho.int
| CharacterString
| URL
a| A uniform resource locator (URL) is a URI that provides a means
of locating the resource by describing its primary access mechanism
(RFC 3986).

[example]
http://registry.iho.int

| URI
| URN
a| A persistent, location-independent, resource identifier that follows
the syntax and semantics for URNs specified in RFC 2141.

[example]
urn:iho:s101:1:0:0:AnchorageArea

| URI

|===

===== Reference to textual files

The information types *Restrictions, Recommendation, Regulations,
NauticalInformation* should be used to encode textual information.

The files referenced by *textContent*, sub-complex attribute *information*
and its sub attribute *fileReference* must be ++*++.TXT, ++*++.HTM
or ++*++.XML files, and may contain formatted text. It is up to the
Producing Authority to determine the most suitable means of encoding
a particular piece of text. Files must only use UTF-8 character encoding
even when the sub-attribute *language* is populated with a language
other than English.

If it is necessary to indicate a specific section within a large text
file, this may be done by encoding the location in the *fileLocator*
sub-attribute of *information*, as described in <<table_2-7>>.

[[table_2-7]]
.Locators for external files
[cols="40,94,435"]
|===
h| Format h| File extension h| Content of fileLocator
| Text | TXT | The offset of the start of the section relative to
the beginning of the file (the first character in the file has offset 0).
| HTML | HTM | The HTML fragment identifier, i.e., the value of the
HTML _name_ or _id_ attribute of the target (as defined in the relevant
HTML specification).
| XML | XML | The XML fragment identifier as defined in the relevant
specification, e.g., the value of an _xml:id_ attribute.

|===

===== Reference to external sources

References to Internet sources should be encoded using the *onlineResource*
sub-attribute of *textContent*. Encoders should be aware that systems
may not be able to access the Internet, so *onlineResource* should
be used only for non-essential information.

Only sources that can be certified as secure should be provided.

===== Reference to graphics

If it is required to indicate a graphic, the complex attribute *graphic*
must be used. The sub-attribute *pictorialRepresentation* must be
used to indicate the file name (without the path) of the external
graphical file. Graphic files that form part of the data product must
be content with the characteristics collected in <<table_2-8>>.

[[table_2-8]]
.Graphics Characteristics
[cols="291,284"]
|===
h| Characteristics h| Values
| Recommended Resolution: | 96 DPI
| Minimum Size x,y:       | 200,200 pixels
| Maximum Size x,y:       | 800,800 pixels
| Bit Depth:              | 8 Bit Indexed Colour
| Compression:            | LZW
| Format:                 | Tiff 6.0
| File size
| Minimum, consider that 10 Mb is the maximum allowable size of a
dataset

|===

Additional information about the graphic file may be encoded in other
sub-attributes of attribute *graphic*, as described in see <<sec_2.4.13>>.

==== Dates

Dates may be complete or truncated values. The definition of the attribute
will indicate if it must take a complete value (type _Date_ or _DA_)
or is allowed to take a truncated value (type _S100_TruncatedDate_
or _TD_). Complete and truncated dates are different value types (see
S-100 § 1-2 Table 1-2; also <<table_2-9>> of this DCEG).

For attributes that use the complete date type (type _Date_ or _DA_),
all their components (year, month, and day) must be specified.

For attributes that use the truncated date type (type _S100_TruncatedDate_
or _TD_), zero, one, or two of the year/month/day components may be
omitted. If the year component is included, it must be specified using
exactly 4 digits.

[[sec_2.4.10.1]]
===== Complete Dates (Informative)

Complete date values must be encoded in conformance with the Date
format as specified in S-100 Ed. 4.0.0 (§§ 1-4.5.2) which is the same
as the DA format in <<table_2-2>> in this document. The data values
have to be provided in accordance with the Gregorian Calendar starting
with four digits for the year, two digits for the month and two digits
for the day.

====
The date 18 September 2010 is encoded as follows:

In the ISO 8211 format: 20100918

In the GML format: <date>2010-09-18</date>
====

[[sec_2.4.10.2]]
===== Truncated Dates (Informative)

In Truncated Dates one or more components (year, month, or day) of
the date is not specified. Truncated date values must be encoded in
conformance with the S100_TruncatedDate format or equivalent as specified
in S-100 Ed. 4.0.0 (§§ 1-4.5.2 and 3-9) which is the same as the _TD_
format in <<table_2-2>> in this document. If encoding attributes which
can take truncated date values (e.g., *fixedDateRange*, *periodicDateRange*,
*reportedDate*) and no specific year, month, or day is required, the
values must be encoded in conformance with the truncated date format
as specified in S-100 (§§ 1-4.5.2 and 3-9 in Edition 4.0.0) which
defines a default format (for ISO 8211) but also allows the use of
built-in types.

To encode partial dates in the GML and ISO 8211 data formats:

[[table_2-9]]
.Date encoding in GML and ISO 8211 data formats
[cols="3"]
|===
h| Description h| ISO 8211 h| GML
| No specific year, same day each year   | pass-format:metanorma[----MMDD] | <gMonthDay>pass-format:metanorma[--MM-DD]</gMonthDay>
| No specific year, same month each year | pass-format:metanorma[----MM--] | <gMonth>pass-format:metanorma[--MM]</gMonth>
| No specific day                        | pass-format:metanorma[YYYYMM--] | <gYearMonth>YYYY-MM</gYearMonth>
| No specific month and no specific day  | pass-format:metanorma[YYYY----] | <gYear>YYYY</gYear>

|===

NOTE: YYYY = calendar year; MM = month; DD = day.

The dashes (-) indicating that the year, month, or date which is not
specified must be included in the encoding (with no space between
the dashes).

===== Start and end of ranges

In accordance with S-100 Ed. 4.0.0 § 3-8, the start and end instants
of a range or period are included in the range or period.

[example]
If the beginning of a date range is encoded as the complete date 01
January 2016, the period begins at 00:00:00 on 1 January 2016, and
the whole of New Year's Day is included in the period. If the end
of the date range is encoded as 01 January 2016, the period ends at
24:00:00 on 1 January 2016, i.e., again the whole of New Year's Day
is included in the period.

[example]
If the beginning of a period is encoded in truncated date format as
pass-format:metanorma[----01--] (i.e., year and day not specified),
the period begins at 00:00:00 on 1 January each year. If the end of
the period is encoded as pass-format:metanorma[----01--], the period
ends at 24:00:00 on 31 January each year.

NOTE: Particular care should be taken if the start or end date is
28 or 29 February. S-100 Ed. 4.0.0 § 3-8 explains the implications
for end of February. For example, the truncated date
pass-format:metanorma[----02--] will be interpreted as 29 February
in leap years and 28 February in non-leap years, while
pass-format:metanorma[----0228] will be interpreted as 28 February
in every year.

NOTE: In accordance with ISO practice, 00:00:00 means midnight at
the start of a day and 24:00:00 means midnight at the end of a day.

[[sec_2.4.10.4]]
===== Schedules

Weekly service schedules of a feature can be comprehensively described
by using the information types *ServiceHours* and *NonStandardWorkingDay*.

[example]
A feature service is available under normal operation status 24 hours/day
on Monday and Wednesday and from 08:00 to 16:00 LT from Thursday to
Saturday. The service is not available on public holidays and the
5 of August of each year.

[pseudocode%unnumbered]
====
*ServiceHours*
	*scheduleByDayOfWeek*
		*categoryOfSchedule* =1 (normal operation)
		*timeIntervalsByDayofWeek*
			*dayOfWeek* =2(Monday), 4(Wednesday)
			*dayOfWeekIsRange* =0 (false)
			*timeOfDayStart* = 000000
			*timeOfDayEnd* = 240000
		*timeIntervalsByDayofWeek*
			*dayOfWeek* =5(Thursday), 7(Saturday)
			*dayOfWeekIsRange* =1 (true)
			*timeOfDayStart* = 080000
			*timeOfDayEnd* = 160000
*NonStandardWorkingDay*
	*dateFixed* = pass-format:metanorma[----0805] (5 August)
	*dateVariable* = public holidays
====

The above example would be encoded in the Edition 1.0.x GML format
as follows:

[source%unnumbered]
--
<S127:ServiceHours gml:id="(GML ID of ServiceHours)">
  <scheduleByDayOfWeek>
    <categoryOfSchedule>normal operation</categoryOfSchedule>
    <timeIntervalsByDayOfWeek>
      <dayOfWeek>Monday</dayOfWeek>
      <dayOfWeek>Wednesday</dayOfWeek>
      <dayOfWeekIsRange>0</dayOfWeekIsRange>
      <timeOfDayStart>00:00:00</timeOfDayStart>
      <timeOfDayEnd>24:00:00</timeOfDayEnd>
    </timeIntervalsByDayOfWeek>
    <timeIntervalsByDayOfWeek>
      <dayOfWeek>Thursday</dayOfWeek>
      <dayOfWeek>Saturday</dayOfWeek>
      <dayOfWeekIsRange>0</dayOfWeekIsRange>
      <timeOfDayStart>08:00:00</timeOfDayStart>
      <timeOfDayEnd>16:00:00</timeOfDayEnd>
    </timeIntervalsByDayOfWeek>
  </scheduleByDayOfWeek>
  <partialWorkingDay xlink:href="(reference to NonStandardWorkingDay)"/>
</S127:ServiceHours>

<S127:NonStandardWorkingDay gml:id="(GML ID of NonStandardWorkingDay)">
  <dateFixed><gMonthDay>--08-05</gMonthDay></dateFixed>
  <dateVariable>public holidays</dateVariable>
  <theServiceHours_nsdy xlink:href="(reference to ServiceHours)"/>
</S127:NonStandardWorkingDay>
--

If the days of week are known but the hours of availability are unknown,
there is no time attribute. Twenty-four availability is indicated
by encoding the availability period as 000000-240000. Special cases
such as unknown schedules can be explained in the *textContent* or
*information* attribute of *ServiceHours*.

To encode two or more periods within the same day, repeat the *timeOfDayStart*
and *timeOfDayEnd* attributes. If one of the times is not known, it
may be nilled as described in see <<sec_2.4.4>>.

For example, to encode open hours of 8 a.m. to 12 noon and 1 p.m.
to 5 p.m. on Thursdays and Saturdays:

[pseudocode%unnumbered]
====
*timeIntervalsByDayofWeek*

	*dayOfWeek* =5(Thursday), 7(Saturday)
	*dayOfWeekIsRange* =1 (true)
	*timeOfDayStart* = 080000
	*timeOfDayStart* = 130000
	*timeOfDayEnd* = 120000
	*timeOfDayEnd* = 170000

====

The order of repeated *timeOfDayStart* and *timeOfDayEnd* attributes
is significant, since intervals are specified by matching them pairwise
in order.

UTC is indicated by the Z suffix. The absence of the Z suffix indicates
local time.

==== Times

If it is required to provide information of the start time and end
time of an active period of a feature, it must be encoded using the
attributes *timeOfDayStart* and *timeOfDayEnd*. The order has significance.

==== Combination of date schedules and times

Schedule information can also include time of day. The complex attribute
*timeIntervalsByDayofWeek* also includes *timeOfDayStart* and *timeOfDayEnd*
attributes to encode the daily start and end times of service. Complete
instructions on how to encode schedules are described in see <<sec_2.4.10.4>>.

[[sec_2.4.13]]
==== Graphic information

A graphic file should be appropriate for the purpose and should supplement
the information in terms of navigational relevance. Preferably, the
graphic should provide perspective relevant to the view of the mariner.
Graphics should be such that all the information in the graphic is
legible in the application display.

Graphic information must be encoded using the complex attribute *graphic*.
The simple sub-attribute *pictureInformation* should be used to provide
credits to the picture creator, copyright owner etc.

The source date can either be of a complete date (see <<sec_2.4.10.1>>)
or truncated date (see <<sec_2.4.10.2>>) type.

Assuming that graphic information provides a coastal view, mariners
are interested in knowing from which point on sea that graphic has
been taken. The complex attribute *bearingInformation* (see <<sec_2.4.13.1>>)
provides all necessary information.

[[sec_2.4.13.1]]
===== Bearing information

The most accurate information should be provided if it is necessary
to indicate a position from where a picture has been taken. *information*
is a sub-complex attribute of *bearingInformation* and should be used
to specify that no bearing information can be provided whenever such
is the case. The sub-attributes *sectorBearing* and *orientation*
can be used to describe a certain level of inaccuracy in the position
determination.

[[sec_2.5]]
=== Associations

==== Introduction

An association expresses a relationship between two classes - features,
information types, or a feature and an information type. Objects in
the dataset (instances of feature/information types) are related only
if the link between them is encoded in the dataset.

[example]
An *Authority* information type provides the responsible authority
information to the abstract *SupervisedArea* feature. An association
named Service Control (*srvControl*) is used to relate the two classes;
roles are used to convey the meaning of the relationship. The association
is inherited by subclasses of *SupervisedArea* and is thereby available
to its subclass *MilitaryPracticeArea*.

[[fig_2]]
.Information association relating a feature to an information type
image::figure-2.png[]

An association end may have a multiplicity which describes how many
instances the feature or information type instance at the other end
is allowed to are to link to. In <<fig_2>>, any single instance of
*Authority* may link to any number of *MilitaryPracticeArea* instances.

==== Association names

The association name is normally provided by the UML diagram at the
middle of the connection line/arrow between the two involved classes
and can be obtained from the feature and information type tables provided
in this document).

Association names may be omitted in the UML diagrams for the following
reasons:

. the association is defined by an association class, see <<sec_2.5.4>>
(the name of the association class is used);

. to avoid cluttering the diagram -- however, the name is always documented
in the feature/information type tables.

==== Association roles

Either or both association ends can have a name (role). In <<fig_2>>
the roles are *controlledService* and *controlAuthority*. This association
expresses the relationship that a *SupervisedArea* (i.e., its subclasses,
because *SupervisedArea* is an abstract feature and there cannot be
any direct instances of *SupervisedArea*) may have zero or one controlling
*Authorit(ies),* and an *Authority* may be responsible for any number
of *MilitaryPracticeAreas* (or other subclasses of *SupervisedArea*).

Roles may be also omitted from the diagram to reduce clutter -- again,
the role name is documented in the feature/information type tables.

NOTE: Instead of documenting every single role, Product Specifications
may describe rules for defining default roles.

[[sec_2.5.4]]
==== Association classes

Association classes allow relationships to be characterized by one
or more attributes. The attributes of the association class belong
to the association itself, not to any of the features or information
types it connects. An association class is both an association and
a class. Within an S-127 product the association classes
*Permission Type* and *Inclusion Type* may be used for relating vessel
classes to feature and information types.

===== Permission Type

This association class specifies the relationship of the vessel class
to a feature, e.g., whether access to a feature (or use of a facility)
is prohibited or permitted for a specified class of vessel. The class
of vessel is described by the simple and complex attributes of the
information type *Applicability* such as length, cargo, etc. The attributes
of the association class describe the nature of the relationship,
i.e., whether access to an area is permitted or prohibited, or whether
use of a service is required or recommended.

[[fig_3]]
.Association class for hypothetical requirement for use of a radio calling in point by a vessel type
image::figure-3.png[]

[example]
An association between an *Applicability* instance with attribute
*categoryOfDangerousOrHazardousCargo* = Class 3 and an instance of
feature *RadioCallingInPoint*, with *Permission Type*'s attribute
*categoryOfRelationship* = required, means that vessels carrying flammable
liquids (hazardous cargo type class 3 in the IMDG Code) must use the
calling-in point at the *RadioCallingInPoint* instance.

===== Inclusion Type

This association class defines whether a specified customer
(class of vessels, as described by *Applicability*) is excluded or
included from a particular regulation, recommendation, etc. Again,
the attributes of the association class describe the nature of the
relationship; in this case whether the vessel is included or excluded
from the regulation, etc.

[[fig_4]]
.Association class for inclusion of vessel types in regulations
image::figure-4.png[]

[example]
An association between an *Applicability* instance with attribute
*categoryOfDangerousOrHazardousCargo* = IMDG Code Class 3, with
*Inclusion Type*'s attribute *membership* = included, and an association
of a *Regulation* instance to the same Inclusion Type, means that
the information provided by the *Regulation* (a sub-type of *AbstractRXN*)
applies to vessels carrying flammable liquids (hazardous cargo type
class 3 in the IMDG Code).

NOTE: Since *AbstractRXN* is an abstract type, it cannot have direct
instances in the dataset. Only instances of its (non-abstract) sub-types
can be used.

NOTE: Specific tools may use different presentations in their user
interfaces, e.g., as two associations (as described in the text of
the example), or one association with an association class also shown
(as shown in <<fig_4>>).

==== Use of various associations

===== General

In general, associations must be encoded whenever the relationship
is useful for navigation, monitoring, voyage or route planning, or
reporting purposes, or any other purpose for which the dataset is
intended. The multiplicity lower bound of "0" at an association end
means only that the absence of a link to the relevant instance does
not invalidate the dataset. The encoding instructions for individual
feature and information types describe what associations are allowed
and whether they are required or optional.

===== Generic association for uncategorized additional information

Unless other associations are specified, information types are associated
to the relevant features using the association name *AdditionalInformation*
and the role names *providesInformation* and *informationProvidedFor*.

===== Associations to Restrictions, Recommendation, Regulations, and Nautical Information

The *Restrictions, Recommendation, Regulations, Nautical Information*
are associated to the relevant features using the association named
*AssociatedRxN* (inherited from their common abstract super-type).
The roles at the ends of this association are *appliesInLocation*
and *theRxN* (the Restriction, Regulation etc.).

If the regulation applies only to a specific class, or if it mentions
an exempt class, an additional association to an *Applicability* object
is encoded using the *InclusionType* association class.

===== Conventional Association

Certain features and information types may be permitted or required
to have associations to other feature or information types. The allowed
or mandatory associations for a feature/information type are shown
in the application schema (clause 6 -- Product Specification) and
listed in the documentation for individual types (Appendix A - DCEG).
Definitions of the associations and roles are also given in the DCEG.

==== Where to Encode Associations

The presentation and management of associations will be determined
by the user interface of the encoding software tools. Since S-100
edition 4.0.0 permits feature-information associations to be encoded
only from the geographic feature to the information type and not vice
versa, the information-to-feature link might be unavailable or treated
differently from the feature-to-information link.

=== Datasets

==== Types of Datasets

A dataset is a grouping of features, attributes, geometry and metadata
which comprises a specific coverage.

<<table_2-10>> shows the types of datasets which may be produced and
contained within an exchange set:

[[table_2-10]]
.Dataset types
[cols=2]
|===
h| Dataset h| Explanations
| New dataset: | Data for an area different (in coverage and/or extent)
to existing datasets.
| New Edition of a dataset: | A re-issue plus new information which
has not been previously distributed by Updates. Each New Edition of
a dataset must have the same name as the dataset that it replaces
and should have the same spatial extents.
| Update dataset | Updated or new information. Contains information
about objects being added, modified, or deleted.

|===

==== Overlay data sets

S-127 datasets are intended to be used together with S-101 ENC
(or similar data products) which will act as a base layer. The base
layer is expected to provide navigational and visual context. Generally,
an overlay dataset like S-127 does not provide "skin of the earth"
coverage and there will be large areas with no data coverage because
the S-127 application schema does not include any feature for designating
a region as "other", or "not an MTM area" (i.e., there is no S-127
feature equivalent to the S-101 Unsurveyed Area). Further, an overlay
dataset does not include features that provide auxiliary information
such as bathymetry within a routeing measure area.

[[sec_2.6.3]]
==== Data coverage

A Marine Traffic Management dataset can contain one or more *DataCoverage*
features (see <<sec_2.6.3>>). The data boundary is defined by the
extent of the *DataCoverage* meta features. Data must only be present
within *DataCoverage* meta features.

When a feature extends across datasets of overlapping scale ranges,
its geometry must be split at the boundaries of the *DataCoverage*
features and its complete attribute description must be repeated in
each dataset.

A New edition dataset must not change the extent of the data coverage
for the previous edition. Where the extent of the data coverage for
a data product is to be changed, this must be done by issuing a New
Dataset and terminating the previous one(s).

==== Discovery metadata

Discovery metadata is intended to allow applications to find out important
information about datasets and accompanying support files to be examined
without accessing the data itself (or without reading the support
file). Discovery metadata includes, but is not limited to:

* information identifying the product specification and encoding format;
* edition and version numbers, production/release date, and other
details of data creation and updating;
* data coverage of the dataset;
* summary descriptions of content, purpose, use, and limitations;
* identification and contact information for the producer and distributor
of the dataset.

S-127 uses the same components of discovery metadata as S-100.
The mandatory components for discovery metadata are defined in S-100
Edition 4.0.0 Appendix 4A-D and consist of:

. Exchange catalogue -- a single exchange catalogue for an exchange
set. (Subsets of exchange sets are not envisaged.) The elements are
defined in S-100 App. 4A § D-2.2 (S100_ExchangeCatalogue).
. Dataset discovery metadata for each dataset in the exchange set.
Elements are defined in S-100 App. 4A § D-2.6 (S100_DatasetDiscoveryMetaData).
Additional elements have been defined in the main specification.
. Support file discovery metadata for each support file in the exchange
set. Elements are defined in S-100 App. 4A § D-2.11 (S100_SupportFileDiscoveryMetaData).

Discovery metadata is generally encoded separately from the dataset
itself so as to allow applications to read it without processing the
dataset itself (i.e., decrypt, decompress, or load the dataset). The
encoding format should be easily machine-readable and therefore may
be different from the dataset, e.g., the discovery data may be in
XML while the data is encoded as GML 3.2.1 format.

The content and structure of discovery metadata for this product specification
is defined in ... (XML format defined by an XML schema available from
www.iho.int)

==== Dataset header metadata

Dataset header metadata contains structural and discovery metadata
that apply to the whole dataset and are encoded in the dataset file.
The elements are described in S-100 clause 10b-9.6.

==== Dataset units

The depth, height and positional uncertainty units in a dataset must
be metres.

==== Dataset Coverage

Marine Traffic Management datasets are spatially limited.

In areas which include neighbouring producer nations, producing agencies
should co-operate to agree on dataset boundaries and ensure no data
overlap. Where possible, adjoining nations should agree on common
data boundaries within a technical arrangement based on cartographic
convenience and benefit to the mariner.

If an MTM feature extends outside the product coverage and the adjoining
object does not exist, e.g. due to delay in the production process
by the neighbouring HO product, an indication should be placed at
the outer edge of the product.

==== Dataset Feature Object Identifiers

Each feature and information instance within a dataset must have a
unique universal Feature Object Identifier [FOID]. Where a real-world
feature has multiple geometric elements within a single dataset due
to the dataset scheme, the same FOID may be used to identify multiple
instances of the same feature. Features within a dataset may carry
multiple geometries.

Features split across multiple datasets may be identified by the same
FOID. Features repeated in different scale ranges may be identified
by the same FOID.

FOID must not be reused, even when a feature has been deleted. However,
the same feature can be deleted and added again later using the same
FOID.

FOID may eventually be replaced by Maritime Resource Name (MRN).
In this version MRN is not included due to ongoing development on
IHO guidelines for the use of MRN.

==== 180° Meridian of Longitude

Datasets must not cross the 180° meridian of longitude.

=== Geographic names

==== Feature names

If it is required to encode an international or national geographic
name, it must be done using complex attribute *featureName*.

If it is required to encode a geographic name for which there is no
existing feature, an appropriate area feature defined in see <<sec_5>>
must be created. In order to minimise the data volume, these features
should, where possible, use the geometry of existing features.

Geographic names should be encoded with the complex attribute *featureName*.
The complex attribute *featureName* consists of the simple sub-attributes
*language*, *name* and a Boolean type to indicate whether that particular
name is the *displayName* or not.

National geographic names can be left in their original national language
in a non-English iteration of the complex attribute *featureName*
(but only if the national language can be expressed using lexical
level 0 or 1), or transliterated or transcribed and used in an English
iteration of the complex attribute *featureName*, in which case the
national name should be populated in an additional iteration of the
*featureName*.

All area and point features within a Marine Traffic Management product
should be encoded using *featureName* if a name is available.

. A group of features, associated with a particular geographic name,
should have the name encoded using *featureName* on an aggregation
feature (of type surface or point, or no geometry, as appropriate).
The name should not be encoded on the individual hydrographic features.
. A group of service or forecast areas with the same attribute values
associated with the same name should be encoded as spatial attributes
of the same feature (so there would be only one feature with multiple
spatial attributes for location).
. Named features listed in Hydrographic Office's Sailing Directions
or other documents that may assist in locating service information
should be encoded using feature name on the relevant feature (e.g.
*WaterwayArea*).

In all instances, if the exact extent of the feature to be named is
known, a feature must be created. If the exact extent is not known,
or the area is too small, an existing or specifically encoded point
feature should be used to encode the geographic name.

==== Text placement

The cartographic feature *TextPlacement* is used specifically to place
text cartographically. The properties of the *TextPlacement* feature
are described as follows:

Geometry (point) -- the point location of the centre of the text string.

Text type -- the attribute (or class) which is to be placed.

Flip bearing -- the angle forming a semi-circle within which the text
can be placed.

The *TextPlacement* feature is associated to the feature which carries
the text being placed. The attribute *textType* determines which text
string is to be displayed if more than one is present. The *TextPlacement*
feature ensures that as maritime traffic management screen rotates
from "north up" (e.g. if display is set to "course up") text can remain
readable, or clear other important charted information.

[[sec_2.8]]
=== Scale policy

Marine Traffic Management data must be compiled in the best applicable
scale. The use of the data itself is "scale independent". That means
that the data can be used at any scale. S-100 allows the association
of multiple spatial attributes to a single feature instance. Each
of these spatial attributes can in principle be qualified by maximum
and minimum scales. *maximumDisplayScale* and *minimumDisplayScale*
define the range of display scales within which a particular feature
will be portrayed on the display if these scale minimum/maximum functions
are enabled in the ECDIS or another GIS device. A geo feature with
one or more spatial attributes can utilize the scale minimum and scale
maximum attributes on the link to the spatial object. There are essentially
two ways in which these attributes may be used.

. A producer may decide to use only a scale minimum value. This option
is employed when the data producer wishes to turn off the display
of a feature above certain scales. This is particularly useful in
areas with high data density, and when it is expected that the data
will be used a larger scale where data clutter might become an issue.
Features are therefore encoded with an applicable value, which represents
the scale at which the producer wishes to turn off the feature.

. A producer may decide to provide several pairs of scale minimum
and scale maximum values. This decision may be based on the fact that
for one particular feature different spatial instances in different
scale ranges should be provided to supply this particular feature
with more detailed geographic representation at larger scales.

An example can be a building which has two spatial objects associated,
first one with only scale minimum value encoded at 21999, and the
second spatial object encoded with scale maximum at 22000 and scale
minimum encoded with 999999. These values would enable the use of
a highly-detailed geometry at larger scales than 22000, and a less
detailed geometry at scales of 22000 and less, while the building
would be turned off at scales of 999999 and less.

A similar strategy can be followed to enable boundaries to conform
to a scale-dependent geometry such as a coastline. Conformance at
different scales can achieved by using minimum/maximum scales on spatial
attributes to indicate which particular geometry should be used at
a given scale.

Authorities should cooperate at the regional or RENC level to determine
a recommended scale range at which the portrayal of the information
is suitable and consistent.

[[table_2.11]]
.Minimum display and maximum display scales
[cols=1]
|===
h| Scale

| NULL (only allowed on minimum display scale where the maximum display
scale = 10,000,000)
| 1:10,000,000
| 1:3,500,000
| 1:1,500,000
| 1:700,000
| 1:350,000
| 1:180,000
| 1:90,000
| 1:45,000
| 1:22,000
| 1:12,000
| 1:8,000
| 1:4,000
| 1:3,000
| 1:2,000
| 1:1,000

|===

=== Masking

To improve the look and feel of the display of Marine Traffic Management
datasets in ECDIS for the mariner certain features, or certain edges
of features, should be masked.

==== Surface features crossing cell boundaries

When a single feature of type surface crosses the boundaries of adjoining
Marine Traffic Management products, mask the edge where it shares
the geometry of the boundary in each dataset:

[[fig_5]]
.Surface feature crossing MRS products boundaries
image::figure-5.jpeg[]

This allows the features to be displayed as a single feature of type
surface rather than being divided at the dataset product boundary
and having the representation of two separate features.

NOTE: Some production software will automatically truncate (mask)
features at the cell boundary.

NOTE: Occasionally an edge of the boundary of an area actually coincides
with the data product boundary. Where this occurs and the production
system applies automatic truncation (masking) of this edge, the compiler
must "unmask" that edge so as to avoid the appearance of the area
to be "open ended".

Where features of type surface extend beyond the entire limit of data
coverage for the data product (see <<sec_4.3>>), all edges of these
area features should be masked.

[[fig_6]]
.Surface features extending beyond the entire limit of data coverage
image::figure-6.jpeg[]

<<table_2-11>> lists those features of type surface that should have
edges masked where the boundary of the area crosses or extends beyond
the dataset limit or the area of data coverage of the dataset.

[[table_2-11]]
.Features of which edges have to be masked when crossing the dataset boundary
[cols="2"]
|===
h| Feature Type h| Comment

| ConcentrationOfShippingHazardArea |
| PilotageDistrict                  |
| CautionArea                       |
| RouteingMeasure                   |
| UnderkeelClearanceAllowanceArea   |
| PilotBoardingPlace                |
| WaterwayArea                      |
| RestrictedAreaNavigational        |
| RestrictedAreaRegulatory          |
| MilitaryPracticeArea              |
| VesselTrafficServiceArea          |
| LocalPortServiceArea              |
| ShipReportingServiceArea          |
| PlaceOfRefuge                     |
| PiracyRiskArea                    |
| PilotService                      |
| UnderkeelClearanceManagementArea  |

|===

==== "Linear" surface features

If it is required to encode a linear feature when the only allowable
primitive for the relevant feature type is surface (e.g. a service
area along a track, or channel), a "very narrow surface" should be
encoded. The suggested extent is 0.3mm wide at viewing scales (keeping
in mind that S-100 permits different spatial attributes at different
scales.) An edge of this surface should correspond to the position
of the line. All other edges should be masked.

[[fig_7]]
."Linear" Maritime Traffic Management Services
image::figure-7.jpeg[]
